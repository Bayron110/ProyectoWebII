<div class="tarjetas-wrapper">
  <h2 class="titulo">Usuarios Registrados</h2>

  @if (loading) {
    <div class="info">Cargando usuarios...</div>
  } @else {
    @if (usuarios.length === 0) {
      <div class="info">No hay usuarios disponibles.</div>
    } @else {
      <div class="tarjetas-container">
        @for (u of usuarios; track u.id) {
          <div class="tarjeta">
            <div class="tarjeta-campo"><strong>Nombre:</strong> {{ u.nombre }}</div>
            <div class="tarjeta-campo"><strong>Apellido:</strong> {{ u.apellido }}</div>
            <div class="tarjeta-campo"><strong>Cédula:</strong> {{ u.cedula }}</div>
            <div class="tarjeta-campo"><strong>Dirección:</strong> {{ u.direccion }}</div>
            <div class="tarjeta-campo"><strong>Email:</strong> {{ u.correoE }}</div>
            <div class="tarjeta-acciones">
              <button class="btn small" (click)="iniciarEdicion(u)">Editar</button>
              @if (u.id != null) {
                <button class="btn small danger" (click)="pedirEliminar(u.id!)">Eliminar</button>
              }
            </div>
          </div>
        } @empty {
          <div class="info">No se encontraron usuarios.</div>
        }
      </div>
    }
  }
</div>

@if (editId) {
  <div class="modal-backdrop"></div>
  <div class="modal" role="dialog" aria-modal="true" aria-label="Editar usuario">
    <div class="modal-content">
      <h2>Editar Usuario</h2>
      <form (ngSubmit)="guardarEdicion()" #editForm="ngForm" novalidate>
        <div class="input-row"><label for="nombre">Nombre</label><input id="nombre" [(ngModel)]="editBuffer.nombre" name="nombre" required /></div>
        <div class="input-row"><label for="apellido">Apellido</label><input id="apellido" [(ngModel)]="editBuffer.apellido" name="apellido" required /></div>
        <div class="input-row"><label for="cedula">Cédula</label><input id="cedula" [(ngModel)]="editBuffer.cedula" name="cedula" required /></div>
        <div class="input-row"><label for="direccion">Dirección</label><input id="direccion" [(ngModel)]="editBuffer.direccion" name="direccion" required /></div>
        <div class="input-row"><label for="correoE">Email</label><input id="correoE" [(ngModel)]="editBuffer.correoE" name="correoE" type="email" required /></div>
        <div class="modal-actions">
          <button type="submit" class="btn" [disabled]="editForm.invalid">Guardar</button>
          <button type="button" class="btn outline" (click)="cancelarEdicion()">Cancelar</button>
        </div>
      </form>
    </div>
  </div>
}

@if (showDeleteConfirm) {
  <div class="modal-backdrop"></div>
  <div class="confirm-modal" role="alertdialog" aria-modal="true">
    <div class="confirm-content">
      <h3>Confirmar eliminación</h3>
      <p>¿Estás seguro de que deseas eliminar este usuario?</p>
      <div class="confirm-buttons">
        <button class="btn" (click)="confirmarEliminar()">Sí, eliminar</button>
        <button class="btn outline" (click)="cancelarEliminar()">Cancelar</button>
      </div>
    </div>
  </div>
}

@if (showModal) {
  <div class="modal-backdrop" (click)="closeModal()"></div>
  <div class="modal" role="alertdialog" aria-modal="true" [attr.aria-label]="modalTitle">
    <div class="modal-content">
      <div class="status-icon" [ngClass]="modalType">
        <i *ngIf="modalType === 'success'" class="fas fa-check-circle"></i>
        <i *ngIf="modalType === 'error'" class="fas fa-exclamation-circle"></i>
      </div>
      <h2>{{ modalTitle }}</h2>
      <p>{{ modalMessage }}</p>
      <div class="modal-actions">
        <button class="btn btn-primary" (click)="closeModal()">Aceptar</button>
      </div>
    </div>
  </div>
}
