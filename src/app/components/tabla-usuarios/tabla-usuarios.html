<div class="tabla-wrapper">
    <h2 class="titulo">Usuarios Registrados</h2>

    <div *ngIf="loading" class="info">Cargando usuarios...</div>
    <div *ngIf="!loading && usuarios.length === 0" class="info">
        No hay usuarios disponibles.
    </div>

    <table *ngIf="!loading && usuarios.length" class="tabla">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Apellido</th>
                <th>Cédula</th>
                <th>Dirección</th>
                <th>Email</th>
                <th class="accion-col">Acciones</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let u of usuarios">
                <td>{{ u.nombre }}</td>
                <td>{{ u.apellido }}</td>
                <td>{{ u.cedula }}</td>
                <td>{{ u.direccion }}</td>
                <td>{{ u.email }}</td>
                <td class="acciones">
                    <button class="btn small" (click)="iniciarEdicion(u)">Editar</button>
                    <button class="btn small danger" (click)="pedirEliminar(u.id)">
                        Eliminar
                    </button>
                </td>
            </tr>
        </tbody>
    </table>
</div>

<!-- Modal de edición -->
<div class="modal-backdrop" *ngIf="editId"></div>
<div class="modal" *ngIf="editId" role="dialog" aria-modal="true" aria-label="Editar usuario">
    <div class="modal-content">
        <h2>Editar Usuario</h2>
        <form (ngSubmit)="guardarEdicion()" #editForm="ngForm" novalidate>
            <div class="input-row">
                <label>Nombre</label>
                <input [(ngModel)]="editBuffer.nombre" name="nombre" required />
            </div>
            <div class="input-row">
                <label>Apellido</label>
                <input [(ngModel)]="editBuffer.apellido" name="apellido" required />
            </div>
            <div class="input-row">
                <label>Cédula</label>
                <input [(ngModel)]="editBuffer.cedula" name="cedula" required />
            </div>
            <div class="input-row">
                <label>Dirección</label>
                <input [(ngModel)]="editBuffer.direccion" name="direccion" required />
            </div>
            <div class="input-row">
                <label>Email</label>
                <input [(ngModel)]="editBuffer.email" name="email" type="email" required />
            </div>
            <div class="modal-actions">
                <button type="submit" class="btn" [disabled]="editForm.invalid">
                    Guardar
                </button>
                <button type="button" class="btn outline" (click)="cancelarEdicion()">
                    Cancelar
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Confirmar eliminación -->
<div class="modal-backdrop" *ngIf="showDeleteConfirm"></div>
<div class="confirm-modal" *ngIf="showDeleteConfirm" role="alertdialog" aria-modal="true">
    <div class="confirm-content">
        <h3>Confirmar eliminación</h3>
        <p>¿Estás seguro de que deseas eliminar este usuario?</p>
        <div class="confirm-buttons">
            <button class="btn" (click)="confirmarEliminar()">Sí, eliminar</button>
            <button class="btn outline" (click)="cancelarEliminar()">Cancelar</button>
        </div>
    </div>
</div>

<!-- Modal de feedback general -->
<div class="modal-backdrop" *ngIf="showModal" (click)="closeModal()"></div>
<div class="modal" *ngIf="showModal" role="alertdialog" aria-modal="true" [attr.aria-label]="modalTitle">
    <div class="modal-content">
        <div class="status-icon" [ngClass]="modalType">
            <i *ngIf="modalType === 'success'" class="fas fa-check-circle"></i>
            <i *ngIf="modalType === 'error'" class="fas fa-exclamation-circle"></i>
        </div>
        <h2>{{ modalTitle }}</h2>
        <p>{{ modalMessage }}</p>
        <div class="modal-actions">
            <button class="btn btn-primary" (click)="closeModal()">Aceptar</button>
        </div>
    </div>
</div>